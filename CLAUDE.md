# Claude Instructions

## Синхронизация между Claude-клиентами (КРИТИЧЕСКИ ВАЖНО!)

Эта система обеспечивает синхронизацию между:
- **Local Claude Code** (терминал)
- **claude.ai/code** (веб-версия CC)
- **claude.ai** (веб-чат)

### Протокол синхронизации

#### В НАЧАЛЕ каждой сессии:
```bash
# 1. Обновить репозиторий
git pull

# 2. Прочитать статус проекта
cat sync/SYNC_STATUS.md
```

#### В КОНЦЕ каждой сессии:
```bash
# 1. Обновить sync/SYNC_STATUS.md (добавить что сделано)
# 2. Закоммитить и запушить
git add sync/ && git commit -m "sync: update session status" && git push
```

### Формат sync/SYNC_STATUS.md

```markdown
# Project Sync Status

## Last Update
- **Date**: YYYY-MM-DD HH:MM
- **Environment**: Local CC | claude.ai/code | claude.ai
- **Author**: [имя]

## Current State
- В работе: [что сейчас делается]
- Завершено: [что готово]
- Блокеры: [если есть]

## Next Steps
1. [следующий шаг]
2. [ещё шаг]

## Session Log
### YYYY-MM-DD HH:MM (Environment)
- Сделано: ...
- Файлы: ...
```

### Активные проекты

| Проект | Путь | Sync файл |
|--------|------|-----------|
| artvision-data | `/Users/antonk/artvision-data` | `sync/SYNC_STATUS.md` |
| artvision-tg-bot | `/Users/antonk/artvision-tg-bot` | `sync/SYNC_STATUS.md` |
| devops-agent | `/Users/antonk/devops-agent` | `sync/SYNC_STATUS.md` |

> `artvision-data-memo` удалён (бэкап: `~/.artvision-data-memo-backup`)

### Репозиторий агентов (100+ штук)

**URL:** https://github.com/artvision-agency/sub-agents.directory
**Локально:** `/Users/antonk/sub-agents.directory`

| Категория | Примеры агентов |
|-----------|-----------------|
| 01-core-development | api-designer, backend-developer, frontend-developer, fullstack |
| 02-language-specialists | angular, django, laravel, nextjs, golang, python, php |
| 03-infrastructure | devops, kubernetes, terraform, cloud-architect, sre |
| 04-quality-security | code-reviewer, qa-expert, security-auditor, performance-engineer |
| 05-data-ai | data-engineer, ml-engineer, llm-architect, prompt-engineer |
| 06-developer-experience | documentation-engineer, refactoring-specialist, mcp-developer |
| 07-specialized-domains | seo-specialist, fintech, blockchain, game-developer |
| 08-business-product | product-manager, technical-writer, ux-researcher |
| 09-meta-orchestration | multi-agent-coordinator, workflow-orchestrator, task-distributor |
| 10-research-analysis | competitive-analyst, market-researcher, trend-analyst |

**Использование:** читать `.md` файлы из `content/[категория]/[агент].md`

### Для claude.ai (веб-чат без доступа к файлам)

1. Загрузи `sync/SYNC_STATUS.md` в **Project Knowledge**
2. Или скопируй содержимое в начало разговора
3. В конце сессии — скопируй обновлённый статус обратно в файл через другой клиент

---

## Temporary Scripts

When creating temporary scripts that perform temporary tasks but are not
part of the final project (e.g., data migration scripts, one-time setup
scripts, testing utilities), place them in the `.claude_temp_scripts`
folder to keep the project clean and organized.

## Date Awareness

При запросах с временными указателями ("сейчас", "вчера", "завтра", "на этой неделе", "в этом месяце", "recently", "current", "latest" и т.д.):
1. Проверь текущую дату из системного контекста (env)
2. Используй правильный год в поисковых запросах
3. Не полагайся на knowledge cutoff — всегда ищи актуальную информацию

---

## СОЗДАНИЕ ВЕБ-СТРАНИЦ — ОБЯЗАТЕЛЬНЫЙ WORKFLOW

### Когда применяется:
- Создание/редизайн HTML страниц
- Перенос контента с одного сайта на другой
- Создание шаблонов страниц
- Любая задача "сделай страницу как..."

### ОБЯЗАТЕЛЬНЫЕ ШАГИ (для ВСЕХ проектов!):

```
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 1: ПАРСИНГ КОНТЕНТА (100% полнота!)                    │
│  ──────────────────────────────────────                     │
│  • WebFetch исходной страницы                               │
│  • Запросить ВСЕ блоки: H1, ВСЕ H2, ВСЕ списки, ВСЕ тексты  │
│  • НЕ сокращать, НЕ "основные моменты" — ДОСЛОВНО           │
│  • Если контент большой — запросить частями                 │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 2: ВЫЗОВ frontend-developer (ОБЯЗАТЕЛЬНО!)             │
│  ──────────────────────────────────────────────             │
│  Task(                                                      │
│    subagent_type = "frontend-developer",                    │
│    prompt = "ПОЛНЫЙ контент + структура/стили эталона"      │
│  )                                                          │
│  • Передать 100% контента — ни слова меньше!                │
│  • Указать CSS/структуру эталона если есть                  │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 3: ПРОВЕРКА ПОЛНОТЫ                                    │
│  ──────────────────────                                     │
│  • Открыть в браузере                                       │
│  • Сверить количество блоков с оригиналом:                  │
│    - Сколько H2 секций?                                     │
│    - Сколько FAQ вопросов?                                  │
│    - Сколько карточек/преимуществ?                          │
│    - Есть ли все кейсы/примеры?                             │
│  • Если расхождение — исправить!                            │
└─────────────────────────────────────────────────────────────┘
```

### ЗАПРЕЩЕНО:
- ❌ Сокращать контент ("основные моменты", "ключевые блоки")
- ❌ Передавать контент в prompt текстом БЕЗ проверки полноты
- ❌ Создавать страницу без вызова frontend-developer
- ❌ Не проверять результат на соответствие оригиналу

### Чек-лист коммерческих страниц:
| Блок | Обязателен |
|------|------------|
| Hero + H1 | ✅ |
| Описание услуги | ✅ |
| Преимущества / Почему мы | ✅ |
| Цены / Тарифы | ✅ |
| FAQ (≥5 вопросов) | ✅ |
| Кейсы / Примеры работ | ⚠️ если есть |
| Форма обратной связи | ✅ |
| Контакты (телефон, email, адрес) | ✅ |
| CTA кнопки | ✅ |

---

## ПЛАТНЫЕ API И ДЕНЬГИ — СТРОГИЕ ПРАВИЛА

### АБСОЛЮТНЫЙ ЗАПРЕТ без явного подтверждения:

1. **НИКОГДА не вызывать платные API автоматически:**
   - Topvisor: `checker/go`, любые методы списания
   - Любые сервисы с балансом (Яндекс.Директ, API рекламных систем)
   - Отправка SMS, email-рассылки
   - Любые операции, которые тратят деньги

2. **Перед ЛЮБЫМ платным вызовом ОБЯЗАТЕЛЬНО:**
   - Показать пользователю ТОЧНО какой запрос будет выполнен
   - Показать расчёт стоимости операции
   - Показать какие проекты/сущности затронет
   - Дождаться ЯВНОГО подтверждения: "да", "запускай", "подтверждаю"

3. **Формат запроса подтверждения:**
   ```
   ПЛАТНАЯ ОПЕРАЦИЯ

   Действие: [что будет сделано]
   Затронет: [какие проекты/сущности]
   Стоимость: [расчёт в рублях]

   Подтвердить? (напиши "да" для выполнения)
   ```

4. **Если не уверен — НЕ ДЕЛАЙ:**
   - Лучше спросить лишний раз, чем потратить чужие деньги
   - При любых сомнениях — остановиться и уточнить

5. **После ошибки с деньгами:**
   - Немедленно сообщить пользователю
   - Показать что именно потрачено
   - Не пытаться скрыть или преуменьшить

### Платные сервисы в проекте:
- **Topvisor** (tokens.json): проверка позиций, API
- **Яндекс API**: если будет подключен

---

## Git Auto-Commit Rules

После изменения файлов (Write, Edit) автоматически выполняй:
1. `git add` для изменённых файлов
2. `git commit` с понятным сообщением на английском (что изменено и зачем)
3. `git push` в remote

Формат коммита:
```
<type>: <short description>

Co-Authored-By: Claude <noreply@anthropic.com>
```

Типы: feat, fix, docs, refactor, style, chore

Исключения (НЕ коммитить автоматически):
- Файлы с секретами (.env, credentials, keys) — кроме tokens.json
- Временные файлы (.claude_temp_scripts/)
- Если пользователь явно просит не коммитить

Примечание: tokens.json коммитить автоматически (репо приватный)

### Правило для токенов и секретов
При изменении tokens.json или добавлении новых API ключей:
1. Сообщить пользователю что изменилось
2. Спросить подтверждение на коммит
3. После подтверждения — закоммитить с понятным описанием

---

## АГЕНТЫ И ОПТИМИЗАЦИЯ ТОКЕНОВ

### Установленные агенты

#### 🌍 Глобальные агенты (~/.claude/agents/)
Работают во всех проектах:

| Агент | Триггер | Назначение |
|-------|---------|------------|
| **token-guardian** | Автоматически при больших задачах | Анализ задачи, оценка токенов, оптимальная стратегия |
| **sysadmin-orchestrator** | "проверь инфраструктуру", "валидируй токены" | Мониторинг VPS, SSH, API, бэкапы |
| **frontend-developer** | "создай страницу", "сверстай" | Frontend разработка (HTML/CSS/JS) |
| **seo-analyzer** | "SEO аудит" | SEO анализ и рекомендации |
| **landing-page-agent** | "создай лендинг" | Копирайтинг для лендингов |
| **api-integration-specialist** | "интеграция API" | REST/GraphQL интеграции |
| **data-engineer** | "ETL", "data pipeline" | Обработка данных |

#### 🎨 Artvision-специфичные агенты (artvision-data/.claude-agents/)
Только для проекта artvision-data:

```
Цепочка Universal Page Generator:
frontend-developer → code-reviewer → image-optimizer →
ui-comprehensive-tester → task-completion-validator
```

### Защита от перерасхода токенов

**Проблема 24-25.01.2026**: 3.4M токенов за 2 дня из-за чтения огромных файлов

**Решение** (установлено 26.01.2026):

#### Хуки (~/.claude/hooks/)
- `pre-read.sh` — блокирует чтение файлов >10K строк
- `context-monitor.sh` — предупреждает при переполнении контекста
- См. `~/.claude/hooks/README.md`

#### Token Guardian агент
- Анализирует задачи ДО выполнения
- Предлагает Grep вместо Read для больших файлов
- Рекомендует Task tool для изоляции контекста
- См. `~/.claude/agents/token-guardian.md`

### Правила использования токенов

**ОБЯЗАТЕЛЬНО использовать:**
- Файл >2K строк → Grep или Read с offset/limit
- Файл >10K строк → ТОЛЬКО Grep
- Анализ большого проекта → Task tool (изолированный контекст)
- node_modules/ → НИКОГДА не читать

**Лимиты:**
- Контекст: 200K токенов
- Чтение файла: 25K токенов
- Размер файла: 256KB

**См. также:**
- `artvision-data/docs/TOKEN_USAGE_GUIDE.md` — полное руководство
- `~/.claude/hooks/README.md` — документация хуков

---

## ОБЯЗАТЕЛЬНАЯ ПРОВЕРКА СОЗДАННЫХ ФАЙЛОВ

Пользователь не специалист. После создания/изменения конфигурационных файлов ОБЯЗАТЕЛЬНО:

### 1. Перед созданием конфигов
- WebSearch по официальной документации
- Прочитать существующий файл — расширять, не создавать новый
- Убедиться в правильном формате (JSON vs YAML, структура)

### 2. После создания/изменения
- Проверить синтаксис (JSON: `python3 -c "import json; json.load(open('file'))"`)
- Проверить что файл читается системой
- Для hooks/плагинов — протестировать что срабатывают

### 3. Конфликты и совместимость
- Проверить нет ли дубликатов (агенты с одинаковыми именами)
- Проверить приоритеты (проект > глобальный > плагин)
- При сомнениях — использовать агента для ревью

### Агенты для проверки
| Тип файла | Агент |
|-----------|-------|
| Код | code-reviewer |
| Архитектура | architect-reviewer |
| Конфиги | comprehensive-review |
| Security | security-auditor |


---

## ПЕРВЫЙ ЗАПУСК НА НОВОЙ МАШИНЕ

Если это новая машина или аккаунт — выполни:

```bash
curl -sL https://raw.githubusercontent.com/artvision-agency/claude-code-settings/main/scripts/full-setup.sh | bash
```

Это установит:
- 199 агентов
- 33 плагина  
- Hooks защиты
- Все настройки

После этого перезапусти Claude Code.
